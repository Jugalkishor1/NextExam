<div class="container">
  <h1>Test Result</h1>
  
  <div class="result-summary">
    <h2><%= @mock_test.title %></h2>
    <div class="score-card">
      <p>Your Score: <strong><%= @attempt.score %> / <%= @mock_test.total_marks %></strong></p>
      <p>Percentage: <strong><%= (@attempt.score / @mock_test.total_marks * 100).round(2) %>%</strong></p>
      <p>Time Taken: <strong><%= (@attempt.time_taken / 60).round %> minutes</strong></p>
    </div>
  </div>

  <h3>Detailed Analysis</h3>
  <% @questions.each_with_index do |question, index| %>
    <div class="question-result">
      <div class="question-header">
        <span class="question-number">Question <%= index + 1 %></span>
        <span class="subject-badge"><%= question.subject.name %></span>
        <% if @user_answers[question.id]&.is_correct %>
          <span class="badge badge-success">Correct</span>
        <% else %>
          <span class="badge badge-danger">Incorrect</span>
        <% end %>
      </div>
      
      <p class="question-text"><%= question.content %></p>
      
      <div class="options-review">
        <% question.options.each do |option| %>
          <div class="option <%= 'correct' if option.is_correct %> <%= 'selected' if @user_answers[question.id]&.option_id == option.id %>">
            <%= option.content %>
            <% if option.is_correct %>
              <span class="label">Correct Answer</span>
            <% end %>
            <% if @user_answers[question.id]&.option_id == option.id %>
              <span class="label">Your Answer</span>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%= link_to "Back to Mock Tests", mock_tests_path, class: "btn btn-primary" %>
</div>
