<div class="max-w-5xl mx-auto px-4 py-8 font-sans text-gray-900 dark:text-gray-100">
  <!-- Breadcrumb -->
  <div class="flex flex-wrap items-center gap-2 mb-6 text-sm text-gray-500 dark:text-gray-400">
    <%= link_to "Mock Tests", mock_tests_path, class: "text-blue-600 dark:text-blue-400 hover:underline" %>
    <span>/</span>
    <%= link_to @mock_test.title, mock_test_path(@mock_test), class: "text-blue-600 dark:text-blue-400 hover:underline" %>
    <span>/</span>
    <span>My Attempts</span>
  </div>

  <!-- Page Header -->
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-8 mb-8 shadow-sm">
    <h1 class="text-2xl md:text-3xl font-bold mb-2">My Attempts - <%= @mock_test.title %></h1>
    <p class="text-gray-600 dark:text-gray-400">View your previous attempts and track your progress</p>
  </div>

  <!-- Attempts List -->
  <div class="flex flex-col gap-6">
    <% if @attempts.any? %>
      <% @attempts.each_with_index do |attempt, index| %>
        <%
          total_questions = attempt.mock_test.mock_test_questions.count
          correct_answers = attempt.user_answers.where(is_correct: true).count
          wrong_answers = attempt.user_answers.where(is_correct: false).where.not(option_id: nil).count
          percentage = attempt.percentage_score
          performance_class, performance_text =
            case percentage
            when 80..100 then ['bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300', 'Excellent']
            when 60...80 then ['bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300', 'Good']
            when 40...60 then ['bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300', 'Average']
            else ['bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-300', 'Needs Improvement']
            end
          total_marks = attempt.mock_test.mock_test_questions.sum { |mtq| mtq.question.marks }
        %>

        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 transition hover:shadow-lg">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-gray-100 dark:border-gray-700 pb-4 mb-4">
            <div>
              <div class="text-lg font-semibold">Attempt #<%= @attempts.length - index %></div>
              <div class="text-sm text-gray-500 dark:text-gray-400"><%= attempt.completed_at&.strftime("%B %d, %Y at %I:%M %p") %></div>
            </div>
            <span class="mt-2 sm:mt-0 px-3 py-1.5 rounded-full text-sm font-semibold <%= performance_class %>"><%= performance_text %></span>
          </div>

          <div class="flex flex-wrap justify-between gap-4 mb-4">
            <div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Score</div>
              <div class="text-2xl font-bold text-amber-500"><%= percentage.round %>%</div>
            </div>
            <div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Correct</div>
              <div class="text-2xl font-bold text-green-500"><%= correct_answers %>/<%= total_questions %></div>
            </div>
            <div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Wrong</div>
              <div class="text-2xl font-bold text-red-500"><%= wrong_answers %></div>
            </div>
            <div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Time Taken</div>
              <div class="text-2xl font-bold"><%= attempt.time_taken %> min</div>
            </div>
            <div>
              <div class="text-sm text-gray-500 dark:text-gray-400">Marks</div>
              <div class="text-2xl font-bold"><%= attempt.score.to_f.round(1) %>/<%= total_marks.to_f.round(1) %></div>
            </div>
          </div>

          <div class="flex flex-wrap gap-3">
            <%= link_to solutions_user_mock_test_attempt_path(attempt),
                class: "inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold rounded-lg
                transition-all transform hover:scale-105
                focus:outline-none focus:ring-2 focus:ring-offset-2
                shadow-md hover:shadow-lg
                text-black dark:text-white
                bg-gradient-to-r from-amber-500 to-red-500
                hover:from-amber-600 hover:to-red-600
                dark:from-amber-300 dark:to-orange-400
                focus:ring-amber-500 dark:focus:ring-amber-300" do %>
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="flex-shrink-0">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              View Solutions
            <% end %>

            <%= link_to result_user_mock_test_attempt_path(attempt), class: "inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:border-amber-500 hover:text-amber-500 transition" do %>
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              View Results
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <!-- Empty State -->
      <div class="text-center p-10 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto mb-4 text-gray-400 dark:text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <h3 class="text-xl font-semibold mb-2">No Attempts Yet</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">You haven't attempted this mock test yet. Start your first attempt now!</p>
        <%= link_to "Start Mock Test", start_attempt_mock_test_path(@mock_test), method: :post, data: { turbo: false }, class: "inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-gradient-to-r from-amber-500 to-red-500 text-white font-semibold shadow-md hover:shadow-lg transition" %>
      </div>
    <% end %>
  </div>
</div>
